var BC=angular.module("BC",[]);BC.config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{controller:"Home",templateUrl:"tpl/home.html"}).when("/web-app/import-export",{controller:"WebAppExportImport",templateUrl:"tpl/webapp/import-export.html"}).otherwise({redirectTo:"/"})}]),BC.run(["$rootScope","$location",function($rootScope,$location){$rootScope.msgBuffer=[],$rootScope.message=null,$rootScope.sendMessage=function(msg){$rootScope.msgBuffer.push(msg)},chrome.tabs.getSelected(null,function(tab){var worker=chrome.tabs.connect(tab.id,{name:"BC"});for(worker.onMessage.addListener(function(msg){msg&&msg.event&&$rootScope.$broadcast(msg.event,msg.data)}),$rootScope.sendMessage=function(msg){worker.postMessage(msg)};msg=$rootScope.msgBuffer.shift();)$rootScope.sendMessage(msg)}),$rootScope.$on("Page:getContentType",function(e,data){"WebApp"==data&&$location.path("/web-app/import-export"),$rootScope.$apply()}),$rootScope.sendMessage({action:"Page:getContentType"})}]),BC.controller("Home",["$rootScope","$location",function(){}]),BC.controller("WebAppExportImport",["$scope",function($scope){$scope.reset=function(e){return $scope.loading?(e.preventDefault(),void 0):($scope.message=$scope.webAppSettings=$scope.importSettings=null,void 0)},$scope.export=function(){$scope.loading=!0,$scope.message=$scope.webAppSettings=null,$scope.sendMessage({action:"WebApp:exportSettings"})},$scope.import=function(){$scope.loading=!0,$scope.message=null;try{JSON.parse($scope.importSettings),$scope.sendMessage({action:"WebApp:importSettings",argv:[$scope.importSettings]})}catch(e){$scope.loading=!1,$scope.message={text:"Invalid JSON data!",css:"alert-error"}}},$scope.$on("WebApp:importSettings",function(){$scope.loading=!1,$scope.importSettings=null,$scope.$apply()}),$scope.$on("WebApp:exportSettings",function(e,data){$scope.loading=!1;try{$scope.webAppSettings=JSON.stringify(data)}catch(e){$scope.message={text:"Web app export generated an invalid JSON data. Maybe this is a bug. Please submit it to the developer.",css:"alert-error"}}$scope.$apply()}),$scope.$on("WebApp:getInfo",function(e,data){$scope.webApp=data,$scope.$apply()}),$scope.$on("Page:status",function(e,data){$scope.message=data,$scope.$apply()}),$scope.sendMessage({action:"WebApp:getInfo"})}]);